# Makefile for JSON-enabled thulr_cmdline

CC = g++
CFLAGS = -g -Wall -std=c++11
INCLUDES = -I. -I../compression
LIBS = -lzstd -ljson-c

# Source files
JSON_SOURCES = LogStore_API_JSON.cpp thulr_cmdline_json.cpp
JSON_HEADERS = LogStore_API_JSON.h

# Object files
JSON_OBJECTS = $(JSON_SOURCES:.cpp=.o)

# Default target
json: thulr_cmdline_json

# Build JSON-enabled query tool
thulr_cmdline_json: $(JSON_OBJECTS) LogStore_API.o LogStructure.o SearchAlgorithm.o
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $^ $(LIBS)

# Compile JSON source files
LogStore_API_JSON.o: LogStore_API_JSON.cpp LogStore_API_JSON.h
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

thulr_cmdline_json.o: thulr_cmdline_json.cpp LogStore_API_JSON.h
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

# Existing object files
LogStore_API.o: LogStore_API.cpp LogStore_API.h LogStructure.h
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

LogStructure.o: LogStructure.cpp LogStructure.h
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

SearchAlgorithm.o: SearchAlgorithm.cpp SearchAlgorithm.h
	$(CC) $(CFLAGS) $(INCLUDES) -c $<

# Clean
json-clean:
	rm -f $(JSON_OBJECTS) thulr_cmdline_json

# Install dependencies (macOS)
install-deps-mac:
	brew install json-c

# Install dependencies (Ubuntu/Debian)
install-deps-ubuntu:
	sudo apt-get install libjson-c-dev

.PHONY: json json-clean install-deps-mac install-deps-ubuntu